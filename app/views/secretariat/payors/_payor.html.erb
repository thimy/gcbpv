<div id="<%= dom_id payor %>" class="record">
  <div class="page-info">
    <dl class="horizontal">
      <dt>Nom :</dt>
      <dd><%= payor.name %></dd>
      <dt>Adresse :</dt>
      <dd><%= payor.full_address %></dd>
    </dl>
    <dl class="horizontal">
      <dt>Email :</dt>
      <dd><%= payor.email %></dd>
      <dt>Téléphone :</dt>
      <dd><%= format_phone(payor.phone) %></dd>
    </dl>
  </div>

  <section class="flex-column gap-8">
    <% payor.subscription_groups.each do |subscription_group| %>
      <div>
        <h2>Membres du foyer</h2>
        <%= render Shared::Table::Component.new do |table| %>
          <% table.with_header do |header| %>
            <% header.with_column(name: "student") do %>Élève<% end %>
            <% header.with_column(name: "course") do %>Cours<% end %>
            <% header.with_column(name: "workshop") do %>Ateliers<% end %>
            <% header.with_column(name: "comment") do %>Notes<% end %>
          <% end %>
          <% subscription_group.subscriptions.each do |subscription| %>
            <% table.with_row(link_url: secretariat_subscription_path(subscription), class: "#{subscription.optional? ? "optional" : "confirmed"}") do |row| %>
              <% row.with_cell(name: "student") do %><%= link_to subscription.student.name, secretariat_subscription_path(subscription), "data-turbo": false %><% end %>
              <% row.with_cell(name: "course") do %>
                <%= [subscription.kid_workshop_list, subscription.course_list, subscription.pathway_list].reject!(&:empty?).join(", ") %><% end %>
              <% row.with_cell(name: "workshop") do %><%= subscription.workshop_list %><% end %>
              <% row.with_cell(name: "comment") do %><%= subscription.comment %><% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <div>
        <h2>Paiements</h2>
        <dl class="horizontal">
          <dt>Montant :</dt>
          <dd><%= payor.current_subscription_group.amount %></dd>
          <dt>Agglo :</dt>
          <dd><%= payor.current_subscription_group.majoration_class %></dd>
        </dl>
        <%= render Shared::Table::Component.new do |table| %>
          <% table.with_header do |header| %>
            <% header.with_column(name: "payment_method") do %>Type de paiement<% end %>
            <% header.with_column(name: "amount") do %>Montant<% end %>
            <% header.with_column(name: "comment") do %>Notes<% end %>
          <% end %>
          <% subscription_group.payments.each do |payment| %>
            <% table.with_row do |row| %>
              <% row.with_cell(name: "payment_method") do %><%= payment.payment_method %><% end %>
              <% row.with_cell(name: "amount") do %><%= payment.amount %><% end %>
              <% row.with_cell(name: "comment") do %><%= payment.comment %><% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </section>
</div>
